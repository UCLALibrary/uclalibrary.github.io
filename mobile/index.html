<!DOCTYPE html>
<html>
	<head>
		<title>UCLA Mobile | Library</title>
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" /> 
		<script src="js/sidebar.js" type="text/javascript" charset="utf-8" async defer></script>
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		<meta name="viewport" content="height=device-height,width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;" />
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	</head>
	
	<body>
			<div id="navbar" class="title">
				<img id="logo" src="Images/title.png" alt="UCLA Library">
			</div>

			<ul id="libraries">
				<a class="inherit" href="arts.html">
					<li class="library">
						<div id="5" class="inner-library">
							<div class="top">
								<div class="name">Arts Library</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<br>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="biomed.html">
					<li class="library">
						<div id="1" class="inner-library">
							<div class="top">
								<div class="name">
									Biomedical Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="eal.html">
					<li class="library">
						<div id="10" class="inner-library">
							<div class="top">
								<div class="name">
									East Asian Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="law.html">
					<li class="library">
						<div id="2" class="inner-library">
							<div class="top">
								<div class="name">
									Law Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="lsc.html">
					<li class="library">
						<div id="3" class="inner-library">
							<div class="top">
								<div class="name">
									Library Special Collections <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
					<a class="inherit" href="management.html">
					<li class="library">
						<div id="14" class="inner-library">
							<div class="top">
								<div class="name">
									Management Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="music.html">
					<li class="library">
						<div id="16" class="inner-library">
							<div class="top">
								<div class="name">
									Music Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="powell.html">
					<li class="library">
						<div id="7" class="inner-library">
							<div class="top">
								<div class="name">
									Powell Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="yrl.html">
					<li class="library">
						<div id="20" class="inner-library">
							<div class="top">
								<div class="name">
									Research Library (YRL) <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="sel.html">
					<li class="library">
						<div id="25" class="inner-library">
							<div class="top">
								<div class="name">
									Science and Engineering Library <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
				<a class="inherit" href="srl.html">
					<li class="library">
						<div id="27" class="inner-library">
							<div class="top">
								<div class="name">
									Southern Regional Library Facility <br> 
								</div>
								<div class="meta">
									<i class="link fa fa-angle-right fa-2x"></i>
								</div>
							</div>
							<div class="bottom">
								<span class="time">Loading...</span>
								<div class="round"></div>
							</div>
						</div>
					</li>
				</a>
				<hr class="divider">
			</ul>
	</body>

	<script type="text/javascript">
		function getTimes(callback) {
			$.getJSON("http://anumat.com/hours", function(response) {
				return callback(response);
			}).fail(function(jqXHR, textStatus, errorThrown) { alert("Couldn't fetch library timings."); });
		}

		$(function() {
			getTimes(function(times) {
				var d = new Date();
				var currentMinutes = d.getHours()*60+d.getMinutes();
				var weekday = new Array(7);
				weekday[0]=  "sunday";
				weekday[1] = "monday";
				weekday[2] = "tuesday";
				weekday[3] = "wednesday";
				weekday[4] = "thursday";
				weekday[5] = "friday";
				weekday[6] = "saturday";
				var n = weekday[d.getDay()];
				
				console.log(times);
				
				for (var i = 0; i < times.length; i++) {
					openTime = times[i][n].open;
					closeTime = times[i][n].close;
					if (openTime === "12:01 AM" && closeTime === "11:59 PM") {
						$("#" + times[i].id + ".bottom .time").html("Open 24/7");
						$("#" + times[i].id + " .bottom .round").removeClass('cls').removeClass('cl').addClass('op').html("Open");
						continue;
					}
					if (openTime === "closed") {
						$("#" + times[i].id + " .bottom .time").html("Closed");
						$("#" + times[i].id + " .bottom .round").removeClass('cls').removeClass('op').addClass('cl').html("Closed");
						continue;
					}
					correctTime = openTime + " - " + closeTime;
					$("#" + times[i].id + " .bottom .time").html(correctTime);
					open = openTime.substring(0, openTime.length-3);
					openDiv = openTime.substring(openTime.length-2);
					close = closeTime.substring(0, closeTime.length-3);
					closeDiv = closeTime.substring(closeTime.length-2);
					open = open.split(":");
					close = close.split(":");
					if (openDiv === "PM" && open[0] === "12") {
						open[0] = (Number(open[0]) + 12);
					}
					if (closeDiv === "PM" || close[0] === "12") {
						close[0] = (Number(close[0]) + 12);
					}
					openMinutes = 60*Number(open[0]) + Number(open[1]);
					closeMinutes = 60*Number(close[0]) + Number(close[1]);
					if (currentMinutes > openMinutes && currentMinutes < closeMinutes) {
						$("#" + times[i].id + " .bottom .round").removeClass('cls').removeClass('cl').addClass('op').html("Open");
					}
					if (currentMinutes > openMinutes && closeMinutes - currentMinutes < 60) {
						$("#" + times[i].id + " .bottom .round").removeClass('cl').removeClass('op').addClass('cls').html("Closing soon");
					}
					if (currentMinutes < openMinutes ||  currentMinutes > closeMinutes) {
						$("#" + times[i].id + " .bottom .round").removeClass('cls').removeClass('op').addClass('cl').html("Closed");
					}
				}
			});
		});
	</script>
	
	<script>
		$(function() {
			$('[data-eager-element="true"]').css("display", "none");
		});
	</script>
</html>